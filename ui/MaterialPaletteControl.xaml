<UserControl x:Class="RhinoCncSuite.ui.MaterialPaletteControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:converters="clr-namespace:RhinoCncSuite.ui.Converters"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="300"
             Background="#333" TextElement.Foreground="White"
             Unloaded="UserControl_Unloaded">
    
    <UserControl.Resources>
        <converters:StringToBrushConverter x:Key="StringToBrushConverter" />

        <!-- Icons -->
        <PathGeometry x:Key="IconLightbulb" Figures="M12 2C8.13 2 5 5.13 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.87-3.13-7-7-7zm2 13h-4v-1h4v1zm0-2h-4v-1h4v1zm-2-7c-2.21 0-4 1.79-4 4h8c0-2.21-1.79-4-4-4z"/>
        <PathGeometry x:Key="IconHand" Figures="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
        <PathGeometry x:Key="IconCursor" Figures="M13.65,16.35,11.12,9.12,3.89,6.6,13.65,3.9,16.38,13.62,13.65,16.35M12,2A10,10,0,1,0,22,12,10,10,0,0,0,12,2Z"/>
        <PathGeometry x:Key="IconBag" Figures="M18 6h-2c0-2.21-1.79-4-4-4S8 3.79 8 6H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-6-2c1.1 0 2 .9 2 2h-4c0-1.1.9-2 2-2zm6 16H6V8h2v2c0 .55.45 1 1 1s1-.45 1-1V8h4v2c0 .55.45 1 1 1s1-.45 1-1V8h2v12z"/>
        <PathGeometry x:Key="IconPlus" Figures="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        <PathGeometry x:Key="IconLayout" Figures="M4 4h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4zM4 10h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4zM4 16h4v4H4zm6 16h4v4h-4zm6 0h4v4h-4z"/>
        <PathGeometry x:Key="IconTiles" Figures="M4,4H8V8H4V4M10,4H14V8H10V4M16,4H20V8H16V4M4,10H8V14H4V10M10,10H14V14H10V10M16,10H20V14H16V10M4,16H8V20H4V16M10,16H14V20H10V16M16,16H20V20H16V16Z" />
        <PathGeometry x:Key="IconList" Figures="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z" />
        
        <!-- Button Style -->
        <Style x:Key="HeaderButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="3">
                            <Path Data="{Binding Content, RelativeSource={RelativeSource TemplatedParent}}" 
                                  Fill="White" Stretch="Uniform" Margin="4"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Data Template for Tiles View -->
        <DataTemplate x:Key="MaterialTileTemplate">
            <Border Width="150" Margin="5" Background="#1E1E1E" CornerRadius="5">
                <StackPanel>
                    <!-- Icon Bar -->
                    <Border Background="#000" Padding="5" CornerRadius="5,5,0,0">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <Path Data="{StaticResource IconLightbulb}" Fill="White" Width="14" Height="14" Margin="3"/>
                            <Path Data="{StaticResource IconHand}" Fill="White" Width="14" Height="14" Margin="3"/>
                            <Path Data="{StaticResource IconCursor}" Fill="White" Width="14" Height="14" Margin="3"/>
                            <Path Data="{StaticResource IconBag}" Fill="White" Width="14" Height="14" Margin="3"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Color and Name -->
                    <Border Height="60" Background="{Binding Color, Converter={StaticResource StringToBrushConverter}}">
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" Foreground="White" TextWrapping="Wrap" TextAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    
                    <!-- Dimensions and Thickness -->
                    <Border Background="#000" Padding="8" CornerRadius="0,0,5,5">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="{Binding Dimensions}" VerticalAlignment="Center" Foreground="Gray"/>
                            <TextBlock Grid.Column="1" Text="{Binding FormattedThickness}" FontWeight="Bold" FontSize="18" VerticalAlignment="Center"/>
                        </Grid>
                    </Border>
                </StackPanel>
            </Border>
        </DataTemplate>

        <!-- Data Template for List View -->
        <DataTemplate x:Key="MaterialListTemplate">
            <Border Margin="2,1" Background="#1E1E1E" CornerRadius="3" Padding="5">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Path Data="{StaticResource IconLightbulb}" Fill="White" Width="16" Height="16" Margin="5" VerticalAlignment="Center"/>
                    <Border Grid.Column="1" Width="10" Height="25" Margin="5,0"
                            Background="{Binding Color, Converter={StaticResource StringToBrushConverter}}" CornerRadius="2" VerticalAlignment="Center"/>

                    <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="10,0">
                        <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding FormattedThickness}" FontWeight="SemiBold" Foreground="Red" Margin="0,0,10,0"/>
                            <TextBlock Text="{Binding Dimensions}" Foreground="Gray"/>
                        </StackPanel>
                    </StackPanel>

                    <Path Grid.Column="3" Data="{StaticResource IconHand}" Fill="White" Width="16" Height="16" Margin="3" VerticalAlignment="Center"/>
                    <Path Grid.Column="4" Data="{StaticResource IconCursor}" Fill="White" Width="16" Height="16" Margin="3" VerticalAlignment="Center"/>
                    <Path Grid.Column="5" Data="{StaticResource IconBag}" Fill="White" Width="16" Height="16" Margin="3" VerticalAlignment="Center"/>
                </Grid>
            </Border>
        </DataTemplate>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#252525" Padding="5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal">
                    <Button Name="AddMaterialButton" Content="{StaticResource IconPlus}" Style="{StaticResource HeaderButtonStyle}" Click="AddMaterialButton_Click"/>
                    <Button Name="GlobalSheetLayoutButton" Content="{StaticResource IconLayout}" Style="{StaticResource HeaderButtonStyle}" Click="GlobalSheetLayoutButton_Click"/>
                </StackPanel>

                <TextBlock x:Name="MaterialCountTextBlock" Grid.Column="1" Text="Materials" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold"/>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Name="ViewModeButton" Content="{StaticResource IconTiles}" Style="{StaticResource HeaderButtonStyle}" Click="ViewModeButton_Click"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Content -->
        <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- Tiles View -->
                <ItemsControl x:Name="MaterialItemsControl"
                              ItemsSource="{Binding ProjectMaterials}"
                              ItemTemplate="{StaticResource MaterialTileTemplate}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

                <!-- List View -->
                <ListView x:Name="MaterialsListView"
                          ItemsSource="{Binding ProjectMaterials}"
                          ItemTemplate="{StaticResource MaterialListTemplate}"
                          Visibility="Collapsed"
                          Background="Transparent" BorderThickness="0"
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListViewItem">
                                        <ContentPresenter/>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListView.ItemContainerStyle>
                </ListView>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl> 